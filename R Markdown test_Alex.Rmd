---
title: "Project 1 EDA"
author: "Alex Salamah"
date: "10/9/2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# This is the code for the EDA deliverable for MSDS Project 1.
## Load needed libraries for project
```{r }
# Visualization
library(ggplot2)
library(maps)

library(mapproj)
library(plyr)
library(plotly)
# classification and modeling
library(class)
library(e1071)
library(caret)
library(knitr)
library(tm)
# data exploration and wrangling 
library(tidyverse)
library(readr)
library(skimr)
library(stringr)
#install.packages("skimr")
#devtools::install_github("ropensci/visdat")
#devtools::install_github("alastairrushworth/inspectdf")
library(devtools)
library(dplyr)
library(visdat)
library(inspectdf)
```
## Read each Data file interactively
```{r}
# read files interactively
BrewriesDF <- read.csv(file.choose(), header = TRUE) 
BeersDF <- read.csv(file.choose(), header = TRUE)
```
## EDA Intial Data Profiling
```{r}
#look at the first 10 lines of each Data sets
head(BrewriesDF, 10)
head(BeersDF,10)
glimpse(BrewriesDF)
glimpse(BeersDF)
#explore missing values
skim(BrewriesDF)
skim(BeersDF)
#Visualize Metadata
# vis_dat(BeersDF)
# vis_miss(BeersDF)
# vis_expect(BeersDF, ~.x =="N/A")
# vis_dat(BrewriesDF)
# vis_miss(BrewriesDF)

# Column types
# Using the inspectdf library
Types <- inspect_types(BeersDF)
Types <- inspect_types(BrewriesDF)
show_plot (Types)

# Missing Bar Plots
Nas1 <- inspect_na(BeersDF)
Nas2 <- inspect_na(BrewriesDF)
show_plot(Nas1, )
show_plot(Nas2, )

#Categorical Plot
Catg1 <- inspect_cat(BeersDF)
show_plot (Catg1)
Catg2 <- inspect_cat(BrewriesDF)
show_plot (Catg2)
#Correlations
Corl <- inspect_cor(BeersDF)
show_plot (Corl)

# Distribution of the numeric variables
Numv <- inspect_num(BeersDF)
show_plot(Numv)

#Feature Imbalance
Imb <- inspect_imb(BeersDF)
show_plot (Imb)

```

## Data Cleansing Breweries Data Set
```{r}
# get a unique list of values from city and state
Brewcity<- sqldf('select distinct(City), State from BrewriesDF order by City, State')
#Browsing thru the data found two issues in the city name Menominee.  Need to change to Menominie and St Paul to St, Paul
BrewriesDF$City = str_replace_all(BrewriesDF$City, "St Paul", "St. Paul") 
BrewriesDF$City = str_replace_all(BrewriesDF$City, "Menominee", "Menominie") 
skim(BrewriesDF)
```

## Q1. How many breweries are present in each state?
```{r}
#Block of Code to Generate Heat Map
  # create a datafarme with state Abbreviation and names
  lookup = data.frame(abb=state.abb, state= state.name )
  View(lookup)
  View(BrewriesDF)
  #rename column state to abb
  colnames(BrewriesDF)[4] = "abb"
  # create a new data set with BrewriesDF and lookup data
  BrewriesDF1 = merge(BrewriesDF,lookup,"abb")
  View(BrewriesDF1)
  # count # of sate in Acu2 data frame
  BrewriesMPD= count(BrewriesDF1,"state")
  View(BrewriesMPD)
  # Change the name of the count column to AcuSpikes
  colnames(BrewriesMPD)[2] = "BrewriesCnt"
  #change the names of the states to lower case.  
  BrewriesMPD$region <- tolower(BrewriesMPD$state)
  # get the longi/lat of the states in order to draw the map
  states <- map_data("state")
  View(states)
  #merge the states long/lat data with AcuMap data
  map.df <- left_join(states,BrewriesMPD, by = "region")
  View(map.df)
  # Plot the data on map
  ggplot(map.df, aes(long, lat, group = group))+
    geom_polygon(aes(fill = BrewriesCnt), stat= "identity", color = "white")+
     #geom_text(aes(label = BrewriesMPD$count, )) +
    scale_fill_gradientn (colours= (heat.colors(3)),na.value="grey90")+
     ggtitle( "Breweries by State", subtitle = "Geopositional Analysis")
# End of Block to Generate Heat Map

## Block of cose to generate Buble Chart 
# libraries
library(packcircles)
library(ggplot2)
library(viridis)
library(ggiraph)
data <- data.frame(group= paste(BrewriesMPD$state), value= (BrewriesMPD$BrewriesCnt) ) 
# Add a column with the text to display withing each bubble:
#data$text <- paste("name: ",data$group, "\n", "value:", data$value, "\n", "You can add a story here!")
data$text <- paste(data$group,":","\n", data$value)
View(data)
# Generate the layout
packing <- circleProgressiveLayout(data$value, sizetype='area')
data <- cbind(data, packing)
dat.gg <- circleLayoutVertices(packing, npoints=50)

# Make the plot :
ggplot() + 
  geom_polygon_interactive(data = dat.gg, aes(x, y, group = id, fill=id , tooltip = data$text[id], data_id = id), colour = "black", alpha = 0.6) +
  scale_fill_viridis() +
  geom_text(data = data, aes(x, y, label = gsub("Group_", "", text)), size=2, color="black") +
  ggtitle("Breweries Count By State") +
  theme_void() + 
  theme(legend.position="none", plot.margin=unit(c(0,0,0,0),"cm") ) + 
  coord_equal()

## End of Block


#
# states_map <- map_data("state")
# 
# 
# brewry_map <- left_join(states_map,BrewriesDF2 , by = "region")
# ggplot(brewry_map, aes(long, lat, group = group))+
#   geom_polygon(aes(fill = AcuSpikes), color = "white")+
#   scale_fill_gradientn (colours= (heat.colors(3)),na.value="grey90")+
#   ggtitle("Breweries by State")
#  scale_fill_viridis_c(option = "C")
```
## Q2. Merge beer data with the breweries data.
## Print the first 6 observations and the last six observations to check the merged file.  
## (RMD only, this does not need to be included in the presentation or the deck.)
```{r}
mergeDF <- merge(BeersDF, BrewriesDF, by.x = "Brewery_id", by.y = "Brew_ID")
View(mergeDF)
skim(mergeDF)
# Correct the Names of the Namex columns
colnames(mergeDF)[2] = "Beer_name"
colnames(mergeDF)[8] = "Brewery_name"
#Print the 1st and last six observation
print("1st six observations of the merged data")
head(mergeDF,6)
print("last six observations of the merged data")
tail(mergeDF,6)
```
## Q3 Address the missing values in each column.
## Data Cleansing Beers Data Set
```{r}
# Vue list of uniqure city/states
BeersDF$ABV = as.numeric(str_replace_na(BeersDF$ABV, replacement =  "0.06"))
# Replace NA with median value of IBU found to be 42.71 from the skim function above
BeersDF$IBU = as.numeric(str_replace_na(BeersDF$IBU, replacement =  "42.71"))
```
#Q4 Compute the median alcohol content(ABV) and international bitterness unit (IBU) for each state. Plot a bar chart to compare.
```{r}
#Compute Means of ABV and IBU by State
StateMeans <- ddply(mergeDF,~State,summarise,meanABV=mean(ABV),meanIBU=mean(IBU))
View(StateMeans)
# Bar Plot Mean ABV by State
ggplot(mergeDF, aes(x=State, y=ABV,fill=State)) + 
  stat_summary(fun.y="mean", geom="bar") +
     ggtitle("ABV Median in States")
# Bar Plot Mean IBU by State
ggplot(mergeDF, aes(x=State, y=IBU,fill=State)) + 
  stat_summary(fun.y="mean", geom="bar") +
     ggtitle("IBU Median in States")
#ggplot(mergeDF, aes(x=State, y=ABV,fill=State)) + geom_boxplot(color = "black")
```
## Q5. Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?
```{r}
 as.character( StateMeans[which.max (StateMeans$meanABV),1] )
 as.character(StateMeans[which.max (StateMeans$meanIBU),1] )
```
# 6. Comment on the summary statistics and distribution of the ABV variable.
```{r}
#BoxPlot
mergeDF %>% ggplot(aes(y=ABV)) + geom_boxplot(fill="skyblue", )  ggtitle("ABV Median in States")
#Histogram
mergeDF %>% ggplot(aes(x=ABV)) + geom_histogram(fill="blue", color="black") + ggtitle("ABV Histogram")

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
